<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.odakorea.pdftLink.mapper.PdfrLinkMapper">



  <sql id="whereStatement">
	    <where>
	    	 
	      <if test="params.schInstCd != null and params.schInstCd != '' ">
	    	   a.enfc_inst_cd= #{params.schInstCd}
	       </if>
	       
	       <if test="params.schRcntnNtnNo != null and params.schRcntnNtnNo != '' ">
	    	   a.rcntn_ntn_no= #{params.schRcntnNtnNo}
	       </if>
	       
	        <if test="params.schBizFldCd != null and params.schBizFldCd != '' ">
	    	   a.biz_fld_cd= #{params.schBizFldCd}
	       </if>
	    	 
	       <if test="params.schDiv != null and params.schDiv != '' ">
	            <if test="params.schDiv == '01'">
	               <![CDATA[ AND biz_prd_bgng_yr  >  #{params.schYear} ]]>
	            </if>
	            <if test="params.schDiv == '02'">
	                 <![CDATA[ AND biz_prd_end_yr  >=  #{params.schYear} ]]>
	            </if>
	            <if test="params.schDiv == '03'">
	                 <![CDATA[ AND biz_prd_end_yr  <  #{params.schYear} ]]>
	           </if>
	        </if>
	   </where>
	 </sql>
	 

	<select id="listOdaBizInfo" resultType="ftMap">	

		SELECT  DISTINCT
				a.biz_id,
				a.dsctn_biz_korn_nm,
				a.biz_prd_bgng_yr,
				a.biz_prd_end_yr ,
				a.enfc_inst_cd,
				a.biz_tpcd,
				a.biz_fld_cd,
				b.rcntn_ntn_no

		FROM tbm_biz_mt a JOIN tbm_biz_rcntn_mt b ON
		a.biz_id=b.biz_id
		
		<include refid="whereStatement"/>

		<choose>
			<when test="params.orderBy != null and params.orderBy != ''">
				ORDER BY ${params.orderBy}
			</when>
			<otherwise>
				order by dsctn_biz_korn_nm desc
			</otherwise>
		</choose>

		<if test="pageable.isPaged">
			LIMIT #{pageable.offset}, #{pageable.pageSize}
		</if>
	
	</select>
	
	
	<select id="countOdaBizInfo" resultType="long">
         SELECT COUNT(1)
         FROM tbm_biz_mt a JOIN tbm_biz_rcntn_mt b ON a.biz_id=b.biz_id
        <include refid="whereStatement"/>
    </select>
    
    
    
    
    <insert id="createBizLinkDmnd" parameterType="ftMap">
    INSERT INTO FTCORE."tbm_biz_rl"
    (
        "mbiz_id",
        "trgt_biz_id",
        "rel_dmnd_dt",
        "biz_rel_tpcd",
        "rel_bgng_dt",
        "biz_rel_stcd",
        "rel_rvw_opnn_cn",
        "rel_cntng_yn",
        "link_psblty_yn",
        "link_dscr_yr",
        "link_prfmnc_cn",
        "reg_dt",
        "reg_user_id",
        "mdfcn_dt",
        "mdfcn_user_id",
        "del_yn"
    )
    VALUES
    (
        #{mbizId},
        #{trgtBizId},
        #{relDmndDt},
        #{bizRelTpcd},
        SYSDATETIME,
        #{bizRelStcd},
        #{relRvwOpnnCn},
        #{relCntngYn},
        #{linkPsbltyYn},
        #{linkDscrYr},
        #{linkPrfmncCn},
        SYSDATETIME ,
        #{userId},
        SYSDATETIME ,
        #{userId},
        'N'
    )
</insert>
    
    
</mapper>